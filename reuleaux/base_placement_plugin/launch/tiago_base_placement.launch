<?xml version="1.0" encoding="UTF-8"?>

<launch>
<!-- Selector for tiago type -->
  <arg name="arm"  default="True"/>
  <arg name="end_effector"  default="pal-gripper"/>
  <arg name="ft_sensor"  default="schunk-ft"/>
  <arg name="laser_model"  default="sick-571"/>
  <arg name="camera_model"  default="orbbec-astra"/>
  <arg name="base_type"  default="pmb2"/>
  <!-- By default, we are not in debug mode -->
  <arg name="debug" default="false" />
  
  <arg name="tiago_gazebo" default="false" />
  
  
  <group if="$(arg tiago_gazebo)">
    <include file="$(find tiago_gazebo)/launch/tiago_gazebo.launch">
    <arg name="end_effector" value="$(arg end_effector)"/>
    <arg name="public_sim" value="true"/>
    <arg name="tuck_arm" value="false"/>
    </include>
  </group>
    
  <group unless="$(arg tiago_gazebo)">
    <!-- We do not have a robot connected, so publish fake joint states -->
    <node name="joint_state_publisher" pkg="joint_state_publisher" type="joint_state_publisher">
      <param name="/use_gui" value="false"/>
      <rosparam param="/source_list">[/move_group/fake_controller_joint_states]</rosparam>
    </node>
    <!-- Given the published joint states, publish tf for the robot links -->
    <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher" respawn="true" output="screen" />
    <!-- Run the main MoveIt executable without trajectory execution (we do not have controllers configured by default) -->
    <include file="$(find tiago_moveit_config)/launch/move_group.launch">
      <arg name="load_robot_description" value="true"/>
      <arg name="arm" value="$(arg arm)"/>
      <arg name="end_effector" value="$(arg end_effector)"/>
      <arg name="ft_sensor" value="$(arg ft_sensor)"/>
      <arg name="laser_model" value="$(arg laser_model)"/>
      <arg name="camera_model" value="$(arg camera_model)"/>
      <arg name="base_type" value="$(arg base_type)"/>
      <arg name="allow_trajectory_execution" value="true"/>
      <arg name="fake_execution" value="true"/>
      <arg name="info" value="true"/>
      <arg name="debug" value="$(arg debug)"/>
    </include>
  </group>
 
  <!-- Selection of kinematics solver -->
  <arg name="kinematics" value="$(optenv IK_SOLVER ik_fast)" />
  <!-- Selection of kinematics solver --> 
  <arg name="moveit_plugin" default="false" />
  <arg unless="$(arg moveit_plugin)" name="command_args" value="-d $(find base_placement_plugin)/rviz/base_placement.rviz" />
  <arg     if="$(arg moveit_plugin)" name="command_args" value="-d $(find tiago_moveit_config)/launch/moveit.rviz" />

  <!--Running RVIZ for base_placement-->
  <node pkg="rviz" type="rviz" output="screen" name="rviz" args="$(arg command_args)" >
    <rosparam command="load" file="$(find tiago_moveit_config)/config/kinematics_$(arg kinematics).yaml"/>
  </node>

</launch>
